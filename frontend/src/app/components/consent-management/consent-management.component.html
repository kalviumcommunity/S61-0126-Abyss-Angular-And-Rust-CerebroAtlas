<div class="consent-management-container">
  <app-sidebar></app-sidebar>
  <h1>Consent Management</h1>
  <p class="subtitle">Manage patient privacy preferences and data sharing consents</p>

  <!-- Stats Row -->
  <div class="stats-row">
    <div class="stat-card granted">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <div class="stat-value">847</div>
      <div class="stat-label">Consents Granted</div>
    </div>
    <div class="stat-card denied">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <div class="stat-value">156</div>
      <div class="stat-label">Consents Denied</div>
    </div>
    <div class="stat-card expiring">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
      </div>
      <div class="stat-value">23</div>
      <div class="stat-label">Expiring Soon</div>
    </div>
    <div class="stat-card compliance">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="9"></circle>
          <path d="M12 3v18"></path>
          <path d="M3 12h18"></path>
        </svg>
      </div>
      <div class="stat-value">100%</div>
      <div class="stat-label">Compliance Rate</div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab" [class.active]="activeTab === 'categories'" (click)="switchTab('categories')">Consent Categories</button>
    <button class="tab" [class.active]="activeTab === 'patients'" (click)="switchTab('patients')">By Patient</button>
    <button class="tab" [class.active]="activeTab === 'history'" (click)="switchTab('history')">History</button>
  </div>

  <!-- Consent Categories Tab -->
  <div class="tab-content" *ngIf="activeTab === 'categories'">
    <div class="consent-grid">

      <!-- Research Use -->
      <div class="consent-card">
        <div class="card-header">
          <div class="icon research">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="12" y1="13" x2="8" y2="13"></line>
              <line x1="12" y1="17" x2="8" y2="17"></line>
            </svg>
          </div>
          <div class="header-text">
            <span class="card-title">Research Use</span>
            <span class="card-desc">Allow anonymized data for medical research</span>
          </div>
        </div>
        <div class="card-body">
          <div class="consent-row" *ngFor="let item of researchUse">
            <div class="consent-info">
              <span class="consent-label">{{item.label}}</span>
              <span class="consent-updated">Updated: 2024-01-10</span>
            </div>
            <div class="consent-controls">
              <span class="status-badge" [ngClass]="{'granted': item.granted, 'denied': !item.granted}">
                <span class="status-dot"></span>
                {{item.granted ? 'Granted' : 'Denied'}}
              </span>
              <label class="switch">
                <input type="checkbox" [(ngModel)]="item.granted">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Emergency Access -->
      <div class="consent-card">
        <div class="card-header">
          <div class="icon emergency">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3.05h16.94a2 2 0 0 0 1.71-3.05L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </div>
          <div class="header-text">
            <span class="card-title">Emergency Access</span>
            <span class="card-desc">Allow emergency access to critical health information</span>
          </div>
        </div>
        <div class="card-body">
          <div class="consent-row" *ngFor="let item of emergencyAccess">
            <div class="consent-info">
              <span class="consent-label">{{item.label}}</span>
              <span class="consent-updated">Updated: 2024-01-10</span>
            </div>
            <div class="consent-controls">
              <span class="status-badge" [ngClass]="{'granted': item.granted, 'denied': !item.granted}">
                <span class="status-dot"></span>
                {{item.granted ? 'Granted' : 'Denied'}}
              </span>
              <label class="switch">
                <input type="checkbox" [(ngModel)]="item.granted">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Government Reporting -->
      <div class="consent-card">
        <div class="card-header">
          <div class="icon government">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
          </div>
          <div class="header-text">
            <span class="card-title">Government Reporting</span>
            <span class="card-desc">Share data with government health agencies</span>
          </div>
        </div>
        <div class="card-body">
          <div class="consent-row" *ngFor="let item of governmentReporting">
            <div class="consent-info">
              <span class="consent-label">{{item.label}}</span>
              <span class="consent-updated">Updated: 2024-01-05</span>
            </div>
            <div class="consent-controls">
              <span class="status-badge" [ngClass]="{'granted': item.granted, 'denied': !item.granted}">
                <span class="status-dot"></span>
                {{item.granted ? 'Granted' : 'Denied'}}
              </span>
              <label class="switch">
                <input type="checkbox" [(ngModel)]="item.granted">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- By Patient Tab -->
  <div class="tab-content" *ngIf="activeTab === 'patients'">
    <div class="tab-header">
      <div class="tab-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span>Patient Consent Overview</span>
      </div>
      <p class="tab-desc">View and manage individual patient consents</p>
      <input type="text" class="search-input" placeholder="Search patients...">
    </div>
    
    <div class="patient-list">
      <div class="patient-row" *ngFor="let patient of patients">
        <div class="patient-avatar">{{patient.id}}</div>
        <div class="patient-info">
          <span class="patient-name">{{patient.name}}</span>
        </div>
        <div class="patient-status">
          <span class="status-badge granted">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            {{patient.granted}} granted
          </span>
          <span class="status-badge denied">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            {{patient.denied}} denied
          </span>
          <span class="status-badge expiring" *ngIf="patient.expiring > 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            {{patient.expiring}} expiring
          </span>
        </div>
        <button class="manage-btn">
          <span>Manage</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- History Tab -->
  <div class="tab-content" *ngIf="activeTab === 'history'">
    <div class="tab-header">
      <div class="tab-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>Consent History</span>
      </div>
      <p class="tab-desc">Complete audit trail of consent changes</p>
    </div>

    <div class="history-list">
      <div class="history-row" *ngFor="let entry of consentHistory">
        <div class="history-icon" [ngClass]="entry.icon">
          <svg *ngIf="entry.icon === 'checkmark'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <svg *ngIf="entry.icon === 'denied'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        </div>
        <div class="history-content">
          <div class="history-action">
            <span class="action-label">{{entry.action}}</span>
            <span class="action-description">{{entry.description}}</span>
          </div>
          <div class="history-meta">
            <span class="meta-by">By {{entry.actor}}</span>
            <span class="meta-date">{{entry.date}} at {{entry.time}}</span>
          </div>
        </div>
        <button class="view-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Privacy Protection Notice -->
  <div class="privacy-notice">
    <div class="privacy-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
      </svg>
    </div>
    <span>All consent data is encrypted and stored securely. Patients can revoke consent at any time. Consent changes are logged for compliance and auditing purposes.</span>
  </div>
</div>
