<div class="consent-management-container">
  <app-sidebar></app-sidebar>
  <h1>Consent Management</h1>
  <p class="subtitle">Manage patient privacy preferences and data sharing consents</p>

  <!-- Stats Row (dynamic or placeholder) -->
  <div class="stats-row">
    <div class="stat-card granted">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <div class="stat-value">{{ grantedCount }}</div>
      <div class="stat-label">Consents Granted</div>
    </div>
    <div class="stat-card denied">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <div class="stat-value">{{ deniedCount }}</div>
      <div class="stat-label">Consents Denied</div>
    </div>
    <div class="stat-card expiring">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
      </div>
      <div class="stat-value">0</div>
      <div class="stat-label">Expiring Soon</div>
    </div>
    <div class="stat-card compliance">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="9"></circle>
          <path d="M12 3v18"></path>
          <path d="M3 12h18"></path>
        </svg>
      </div>
      <div class="stat-value">{{ complianceRate }}</div>
      <div class="stat-label">Compliance Rate</div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab" [class.active]="activeTab === 'categories'" (click)="switchTab('categories')">Consent Categories</button>
    <button class="tab" [class.active]="activeTab === 'patients'" (click)="switchTab('patients')">By Patient</button>
    <button class="tab" [class.active]="activeTab === 'history'" (click)="switchTab('history')">History</button>
  </div>

  <!-- Consent Categories Tab -->
  <div class="tab-content" *ngIf="activeTab === 'categories'">
    <div class="consent-grid">

      <!-- Dynamic Consent Cards from Backend -->
      <div class="consent-card" *ngFor="let consent of consents">
        <div class="card-header">
          <div class="icon" [ngClass]="{
            'research': consent.consent_type.toLowerCase().includes('research'),
            'emergency': consent.consent_type.toLowerCase().includes('emergency'),
            'government': consent.consent_type.toLowerCase().includes('government')
          }">
            <!-- You can customize SVGs based on type if needed -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </div>
          <div class="header-text">
            <span class="card-title">{{consent.consent_type}}</span>
            <span class="card-desc">Consent for {{consent.consent_type}}</span>
          </div>
        </div>
        <div class="card-body">
          <div class="consent-row">
            <div class="consent-info">
              <span class="consent-label">Patient ID: {{consent.patient_id}}</span>
              <span class="consent-updated">Updated: {{consent.created_at}}</span>
            </div>
            <div class="consent-controls">
              <span class="status-badge" [ngClass]="{'granted': consent.granted, 'denied': !consent.granted}">
                <span class="status-dot"></span>
                {{consent.granted ? 'Granted' : 'Denied'}}
              </span>
              <label class="switch">
                <input type="checkbox" [checked]="consent.granted" (change)="onConsentToggle(consent)" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- By Patient Tab -->
  <div class="tab-content" *ngIf="activeTab === 'patients'">
    <div class="tab-header">
      <div class="tab-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span>Patient Consent Overview</span>
      </div>
      <p class="tab-desc">View and manage individual patient consents</p>
      <input type="text" class="search-input" placeholder="Search patients...">
    </div>
    
    <div class="patient-list">
      <!-- Patient consent data should be loaded from backend and displayed here. -->
      <div style="padding: 2em; color: #6b7280; text-align: center;">No patient data available.</div>
    </div>
  </div>

  <!-- History Tab -->
  <div class="tab-content" *ngIf="activeTab === 'history'">
    <div class="tab-header">
      <div class="tab-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>Consent History</span>
      </div>
      <p class="tab-desc">Complete audit trail of consent changes</p>
    </div>

    <div class="history-list">
      <div class="history-row" *ngFor="let consent of consents">
        <div class="history-icon" [ngClass]="consent.granted ? 'checkmark' : 'denied'">
          <svg *ngIf="consent.granted" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <svg *ngIf="!consent.granted" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        </div>
        <div class="history-content">
          <div class="history-action">
            <span class="action-label">{{consent.granted ? 'Granted' : 'Revoked'}}</span>
            <span class="action-description">{{consent.consent_type}}</span>
          </div>
          <div class="history-meta">
            <span class="meta-by">Patient ID: {{consent.patient_id}}</span>
            <span class="meta-date">{{consent.created_at}}</span>
          </div>
        </div>
        <button class="view-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Privacy Protection Notice -->
  <div class="privacy-notice">
    <div class="privacy-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
      </svg>
    </div>
    <span>All consent data is encrypted and stored securely. Patients can revoke consent at any time. Consent changes are logged for compliance and auditing purposes.</span>
  </div>
</div>
